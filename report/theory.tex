% $Id: theory.tex 142 2012-12-22 10:41:32Z danbos $
\chapter{Development of Modern Web Applications}
\label{ch:theory}
\noindent
When developing in a modern context, in particular for the Internet, one needs to
understand how to develop securely, efficiently and without repeating oneself. Though not as much is needed to understand the pertinent areas that this course covers, they are still important to understand the broader strokes.

\section{Separation of Concerns}
\label{sec:architecture}
\noindent
Per \citep{Wikipedia2013ma} Multitier architecture is a ``client–server architecture in which presentation, application processing, and data management functions are logically separated''. In Web Development, that is most commonly generalized to three tiers:

\subsection{Frontend}
\noindent
What is actually served to the browser, whether it's dynamically generated or static. It includes JavaScript, CSS, HTML, typography, graphics, etc. The user interface, or presentation layer. In this system, the least concerns have been put into the frontend, excepting details needed to show understanding of JavaScript-based security issues.

\subsection{Middle}
\noindent
What is most commonly referred to as ``web development'', be it in Ruby on Rails, PHP,
.NET or any other kind of server-side languages. The bulk of this system is written in PHP,
using the framework Laravel.

\subsection{Backend}
\noindent
Where the middle processing technologies generate the frontend consumed by the browser, in most dynamic systems it gets its' information -- data -- from the backend database or data store, whether through a MySQL database, a NoSQL MongoDB or any other kind of system, the backend provides access to the data, and should be properly secured.

\section{oWasp top-10 Vulnerabilities 2013}
\label{sec:owasp2013}
\noindent
oWasp.org \citep{oWasp2013t10} details the 10 most common and/or dangerous vulnerabilities. Most of these require a dynamic system, but having a static HTML site does not remove all the need to think in security. 

\subsection{A1-Injection}
\noindent
Injection is still one of the most common vulnerabilities despite the ease with which one can harden ones' system against that kind of intrusion. The most common case is that a system is too trusting, so it allows users to input data without ensuring that it is the right type, or has likely values. A humorous take on the issues comes from this old (in)famous comic \citep{XKCDBobbyTables}, where the mother has named her son ``Robert'); DROP TABLES Students;--'', which led to a school losing its' student table. 

When it comes to protecting against SQL injection in particular, the best way is to parametrise the connection and not put data into the database without ensuring that it can at least do no harm.

Injection is mainly protected against in the middle and backend.

\subsection{A2-Broken Authentication and Session Management}
\noindent
The best example I can use here is a site I have worked with on occasion. It is written in PHP and MySQL and is going on ten years by now. Sessions are using only the native PHP drivers, and all the information on the user is sent from page to page in a combination of global variables, session variables and hidden form input(!). To my knowledge, there were at least three bugs related to these, where one I solved, the other two are too closely merged with the rest of the system.

\begin{enumerate}
\item There were two different login systems sharing the same space. One was for admin abilities, the other for basic user abilities. The variable \texttt{\$username} was used in both but different values, so if one logged in as basic user and then did a particular admin action, the \texttt{\$username} was overwritten.
\item Sessions times out at regular intervals, and as the system does not take that into account, whatever was being worked on ended up lost
\item By using FireBug or something similar to change the values on one of the login pages, a person could easily hijack another person's session and items just through manipulating the hidden form input.
\end{enumerate}

Depending on how the authentication and session management is handled, this needs to be dealt with either in the frontend or middle. Most traditional web applications covers this in the middle layer, but if the application is written with a large focus on client side -- IE. EmberJS --, as much care needs to be taken on the frontend.

\subsection{A3-Cross-Site Scripting (XSS)}
\noindent
In a way, XSS is a frontend variant of SQL-injection, as the base problem is the same: An application is too trusting of whatever data it is being supplied, and because of this an attacker might be able to execute scripts on that page that will hijack users in various ways. A very common way is to exploit a comment system, where a very recent instance was with two of the most common cache plugins on WordPress, W3 Total Cache and WP Super Cache \citep{Acunetix2013} and the way they interact with the \texttt{mfunc} function. If the blog allowed HTML in the comment system, it would by default also allow PHP.

\subsection{A4-Insecure Direct Object References}
\noindent
To quote oWASP:

\begin{quote}
A direct object reference occurs when a developer exposes a reference to an internal implementation object, such as a file, directory, or database key.
\end{quote}

Generally, this is a failure in the middle and backend. The server shouldn't allow for directories to be browsed (at the very least, ensure that there is an index.html file in each directory), and configuration should not be accessible publicly. Several very common systems -- PHPBB, MediaWiki, to name two -- by default stores their config file in the root of the \texttt{public_html} folder, that is: the same folder that can be accessed through any browser. Of course, assuming that the config files does not echo anything out, it isn't necessarily that big a risk, unless a misconfiguration of the server leaves the site not recognizing the format, and thus prompting a download.

\subsection{A5-Security Misconfiguration}
\noindent
Security misconfiguration comes in two large areas, where one is easier to deal with than the other, depending on your skill and to a certain extent budget. 

\begin{itemize}
\item Framework/Middle configurations are the easiest ones for a web developer to secure. You should always have access to the newest versions of the components you use, and the ability to update them. Ensure that you understand the various options.
\item Server/backend security misconfigurations are reasonably easy to use \emph{if this is your server, or a server you have full access and rights to update software}. If this is shared hosting, you may end up being hit by a vulnerability in the system, such as this recent Ruby on Rails vulnerability\citep{RoR2013Vuln}.
\end{itemize}

\subsection{A6-Sensitive Data Exposure}
\noindent
Many web applications do not properly protect sensitive data, such as credit cards, tax IDs, and authentication credentials. Attackers may steal or modify such weakly protected data to conduct credit card fraud, identity theft, or other crimes. Sensitive data deserves extra protection such as encryption at rest or in transit, as well as special precautions when exchanged with the browser.

\subsection{A7-Missing Function Level Access Control}
\noindent
Most web applications verify function level access rights before making that functionality visible in the UI. However, applications need to perform the same access control checks on the server when each function is accessed. If requests are not verified, attackers will be able to forge requests in order to access functionality without proper authorization.

\subsection{A8-Cross-Site Request Forgery (CSRF)}
\noindent
A CSRF attack forces a logged-on victim’s browser to send a forged HTTP request, including the victim’s session cookie and any other automatically included authentication information, to a vulnerable web application. This allows the attacker to force the victim’s browser to generate requests the vulnerable application thinks are legitimate requests from the victim.

\subsection{A9-Using Components with Known Vulnerabilities}
\noindent
Components, such as libraries, frameworks, and other software modules, almost always run with full privileges. If a vulnerable component is exploited, such an attack can facilitate serious data loss or server takeover. Applications using components with known vulnerabilities may undermine application defenses and enable a range of possible attacks and impacts.

\subsection{A10-Unvalidated Redirects and Forwards}
\noindent
Web applications frequently redirect and forward users to other pages and websites, and use untrusted data to determine the destination pages. Without proper validation, attackers can redirect victims to phishing or malware sites, or use forwards to access unauthorized pages.



\section{Technologies}
\label{sec:technologies}
\noindent

Termer och förkortningar som är viktiga för läsarens förståelse av den 
fortsatta framställningen förklaras i detta kapitel.
Första gången du i den löpande texten använder ett begrepp eller en förkortning 
ska du förklara det, även om det dessutom finns definierat i ett 
terminologiavsnitt.
När begrepp introduceras skrivs de med emfas.

Första gången en \emph{förkortning} (förk.) används skrivs den inom parentes 
efter dess förklaring, såsom exemplifieras i denna mening.

Använd svenska termer så långt det är möjligt.
Se Svenska datatermgruppens rekommendationer på URL
\begin{center}
	\url{http://www.datatermgruppen.se/}.
\end{center}



